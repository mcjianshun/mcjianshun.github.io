<html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>匹配丹方v2.3</title><style>body {font-family: Arial, sans-serif;background-color: #f4f4f4;display: flex;justify-content: center;margin: 0;padding: 0 10px;}.container {background-color: #fff;padding: 20px;border-radius: 8px;box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);width: 100%;max-width: 600px;position: static;}h1 {text-align: center;margin-bo\ttom: 5px;}h2 {text-align: center;margin-bottom: 5px;}textarea {width: 100%;height: 100px;margin-bottom: 20px;padding: 10px;border: 1px solid #ccc;border-radius: 4px;resize: none;}button {display: block;width: 100%;padding: 15px;background-color: #ffb6c1;color: #333;border: none;border-radius: 4px;cursor: pointer;font-size: 10px;margin-bottom: 10px;}#s0 {display: inline-block;width: 23%;padding: 5px;margin: 2px;text-align: center;}button:hover {background-color: #ff91a4;}.copy-button1 {background-color: #ffb6c1;padding: 0;width: 80px;height: 30px;font-size: 14px;line-height: 30px;cursor: pointer;border: none;margin-left: 10px;text-align: center;color: #333;display: inline-block;}.copy-button1:hover {background-color: #ff91a4;}.item {margin-bottom: 3px;display: flex;justify-content: space-between;}.item span {white-space: nowrap;font-size: 10px;line-height: 15px;}@media (max-width: 600px) {.container {padding: 10px;}button {padding: 10px;}}#notification {position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);background-color: #ffb6c1;color: #333;padding: 10px;border-radius: 5px;box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);z-index: 1000;display: none;}.profit-info {margin-top: 20px;padding: 15px;background-color: #f8f9fa;border-radius: 8px;border: 1px solid #dee2e6;}.profit-info h3 {margin-top: 0;margin-bottom: 10px;text-align: center;color: #333;}.profit-item {display: flex;justify-content: space-between;margin-bottom: 8px;padding-bottom: 8px;border-bottom: 1px dashed #ddd;}.profit-item:last-child {border-bottom: none;}.profit-label {font-weight: bold;color: #555;}.profit-value {font-weight: bold;color: #28a745;}.checkbox-container {margin-bottom: 15px;display: flex;align-items: center;}.checkbox-container input {margin-right: 10px;}.checkbox-label {font-size: 14px;color: #333;}</style></head><body><div class="container"><h1>匹配丹方v2.3</h1><div class="checkbox-container"><input type="checkbox" id="use-high-herbs"><label class="checkbox-label" for="use-high-herbs">使用三四品性平药引[勾选后将关闭摄魂鬼丸和化煞魔丸的丹方匹配，优先将药材用于更高级的丹药，这可能有助于提升总利润]</label></div><textarea id="user-input" placeholder="请输入药材..."></textarea><button id="process-button">计算可练丹药</button><button id="clear-button">清空</button><div id="herb-info">&nbsp;</div><div id="profit-info" class="profit-info" style="display:none;"><h3>总利润估算</h3><div class="profit-item"><span class="profit-label">每炉5颗：</span><span class="profit-value" id="profit-5">0</span></div><div class="profit-item"><span class="profit-label">每炉6颗：</span><span class="profit-value" id="profit-6">0</span></div><div class="profit-item"><span class="profit-label">每炉7颗：</span><span class="profit-value" id="profit-7">0</span></div></div></div><script>let li = {'摄魂鬼丸': ['配方主药紫猴花1药引轻灵草1辅药枫香脂1丹炉寒铁铸心炉', '配方主药九叶芝1药引龙葵1辅药炼魂珠1丹炉寒铁铸心炉', '配方主药幻心草1药引弗兰草1辅药玄冰花1丹炉寒铁铸心炉', '配方主药鬼臼草1药引玄参1辅药炼血珠1丹炉寒铁铸心炉'],'化煞魔丸': ['配方主药血莲精1药引菩提花1辅药石龙芮1丹炉寒铁铸心炉', '配方主药鸡冠草1药引乌稠木1辅药锦地罗1丹炉寒铁铸心炉', '配方主药银精芝1药引雪凝花1辅药冰灵果1丹炉寒铁铸心炉', '配方主药玉髓芝1药引龙纹草1辅药玉龙参1丹炉寒铁铸心炉'],'素心真丸': ['配方主药地心火芝1药引天灵果1辅药伴妖草1丹炉寒铁铸心炉', '配方主药天蝉灵叶1药引灯心草1辅药剑心竹1丹炉寒铁铸心炉', '配方主药雪玉骨参1药引穿心莲1辅药绝魂草1丹炉寒铁铸心炉', '配方主药腐骨灵花1药引龙鳞果1辅药月灵花1丹炉寒铁铸心炉'],'灭神古丸': ['配方主药三叶青芝1药引白沉脂1辅药混元果1丹炉寒铁铸心炉', '配方主药七彩月兰1药引苦曼藤1辅药皇龙花1丹炉寒铁铸心炉', '配方主药冰灵焰草1药引诱妖草1辅药黑天麻1丹炉寒铁铸心炉'],'易筋丹': ['配方主药三尾风叶1药引血菩提1辅药天剑笋1丹炉寒铁铸心炉'],'静禅魔丸': ['配方主药地心淬灵乳1药引天问花1辅药血玉竹1丹炉寒铁铸心炉', '配方主药天麻翡石精1药引渊血冥花1辅药肠蚀草1丹炉寒铁铸心炉', '配方主药八角玄冰草1药引芒焰果1辅药凤血果1丹炉寒铁铸心炉', '配方主药奇茸通天菊1药引问道花1辅药冰精芝1丹炉寒铁铸心炉'],'地仙玄丸': ['配方主药檀芒九叶花1药引浩淼水藤1辅药太清玄灵草1丹炉寒铁铸心炉', '配方主药坎水玄冰果1药引道蕴花1辅药冥胎骨1丹炉寒铁铸心炉'],'消冰宝丸': ['配方主药剑魄竹笋1药引炼心芝1辅药鬼面花1丹炉寒铁铸心炉', '配方主药明心问道果1药引重元换血草1辅药梧桐木1丹炉寒铁铸心炉'],'化劫丹': [],'太上玄门丹': []};const basePing = ['宁心草1', '凝血草1', '流莹草1', '蛇涎果1', '轻灵草1', '龙葵1', '菩提花1', '乌稠木1', '天灵果1', '灯心草1', '白沉脂1', '苦曼藤1', '天问花1', '渊血冥花1', '恒心草1', '红绫草1', '五柳根1', '天元果1', '地黄参1', '火精枣1', '风灵花1', '伏龙参1'];const extraPing = ['紫猴花1', '九叶芝1', '炼魂珠1', '枫香脂1', '石龙芮1', '锦地罗1', '鸡冠草1', '血莲精1'];let pe = {'消冰宝丸1': {0: ['离火梧桐芝1', '尘磊岩麟果1'], 1: basePing, 2: ['地龙干1', '龙须藤1', '鬼面花1', '梧桐木1']},'消冰宝丸2': {0: ['剑魄竹笋1'],1: ['鬼面花1', '炼心芝1'],2: ['地龙干1', '龙须藤1', '鬼面花1', '梧桐木1']},'消冰宝丸3': {0: ['明心问道果1'],1: ['梧桐木1', '重元换血草1'],2: ['地龙干1', '龙须藤1', '鬼面花1', '梧桐木1']},'地仙玄丸1': {0: ['木灵三针花1', '鎏鑫天晶草1'], 1: basePing, 2: ['霸王花1', '太清玄灵草1', '冥胎骨1']},'地仙玄丸2': {0: ['檀芒九叶花1'],1: ['太清玄灵草1', '浩淼水藤1'],2: ['霸王花1', '太清玄灵草1', '冥胎骨1']},'地仙玄丸3': {0: ['坎水玄冰果1'],1: ['冥胎骨1', '道蕴花1'],2: ['霸王花1', '太清玄灵草1', '冥胎骨1']},'静禅魔丸1': {0: ['地心淬灵乳1', '天麻翡石精1'], 1: basePing, 2: ['血玉竹1', '肠蚀草1', '凤血果1', '冰精芝1']},'静禅魔丸2': {0: ['八角玄冰草1'],1: ['凤血果1', '芒焰果1'],2: ['血玉竹1', '肠蚀草1', '凤血果1', '冰精芝1']},'静禅魔丸3': {0: ['奇茸通天菊1'],1: ['冰精芝1', '问道花1'],2: ['血玉竹1', '肠蚀草1', '凤血果1', '冰精芝1']},'灭神古丸1': {0: ['三叶青芝1', '七彩月兰1'], 1: basePing, 2: ['混元果1', '皇龙花1', '黑天麻1']},'灭神古丸2': {0: ['三尾风叶1'], 1: ['天剑笋1', '血菩提1'], 2: ['混元果1', '皇龙花1', '黑天麻1']},'灭神古丸3': {0: ['冰灵焰草1'], 1: ['黑天麻1', '诱妖草1'], 2: ['混元果1', '皇龙花1', '黑天麻1']},'易筋丹1': {0: ['三叶青芝1', '七彩月兰1'], 1: basePing, 2: ['天剑笋1']},'易筋丹2': {0: ['三尾风叶1'], 1: ['天剑笋1', '血菩提1'], 2: ['天剑笋1']},'易筋丹3': {0: ['冰灵焰草1'], 1: ['黑天麻1', '诱妖草1'], 2: ['天剑笋1']},'素心真丸1': {0: ['地心火芝1', '天蝉灵叶1'], 1: basePing, 2: ['伴妖草1', '剑心竹1', '绝魂草1', '月灵花1']},'素心真丸2': {0: ['雪玉骨参1'],1: ['绝魂草1', '穿心莲1'],2: ['伴妖草1', '剑心竹1', '绝魂草1', '月灵花1']},'素心真丸3': {0: ['腐骨灵花1'],1: ['月灵花1', '龙鳞果1'],2: ['伴妖草1', '剑心竹1', '绝魂草1', '月灵花1']},'化煞魔丸1': {0: ['血莲精1', '鸡冠草1'], 1: basePing, 2: ['石龙芮1', '锦地罗1', '冰灵果1', '玉龙参1']},'化煞魔丸2': {0: ['银精芝1'],1: ['冰灵果1', '雪凝花1'],2: ['石龙芮1', '锦地罗1', '冰灵果1', '玉龙参1']},'化煞魔丸3': {0: ['玉髓芝1'],1: ['玉龙参1', '龙纹草1'],2: ['石龙芮1', '锦地罗1', '冰灵果1', '玉龙参1']},'摄魂鬼丸1': {0: ['紫猴花1', '九叶芝1'], 1: basePing, 2: ['枫香脂1', '炼魂珠1', '玄冰花1', '炼血珠1']},'摄魂鬼丸2': {0: ['幻心草1'],1: ['玄冰花1', '弗兰草1'],2: ['枫香脂1', '炼魂珠1', '玄冰花1', '炼血珠1']},'摄魂鬼丸3': {0: ['鬼臼草1'], 1: ['炼血珠1', '玄参1'], 2: ['枫香脂1', '炼魂珠1', '玄冰花1', '炼血珠1']},'化劫丹1': {0: ['木灵三针花1', '鎏鑫天晶草1'], 1: basePing, 2: ['阴阳黄泉花1', '厉魂血珀1']},'化劫丹2': {0: ['檀芒九叶花1'],1: ['太清玄灵草1', '浩淼水藤1'],2: ['阴阳黄泉花1', '厉魂血珀1']},'化劫丹3': {0: ['坎水玄冰果1'],1: ['冥胎骨1', '道蕴花1'],2: ['阴阳黄泉花1', '厉魂血珀1']},'太上玄门丹1': {0: ['离火梧桐芝1', '尘磊岩麟果1'], 1: basePing, 2: ['太乙碧莹花1', '森檀木1']},'太上玄门丹2': {0: ['剑魄竹笋1'],1: ['鬼面花1', '炼心芝1'],2: ['太乙碧莹花1', '森檀木1']},'太上玄门丹3': {0: ['明心问道果1'],1: ['梧桐木1', '重元换血草1'],2: ['太乙碧莹花1', '森檀木1']}};const danValue = {'消冰宝丸': 300,'太上玄门丹': 290,'地仙玄丸': 270,'化劫丹': 260,'静禅魔丸': 240,'灭神古丸': 210,'易筋丹': 210,'素心真丸': 180,'化煞魔丸': 150,'摄魂鬼丸': 120};function initLi() {let tempLi = {'摄魂鬼丸': ['配方主药紫猴花1药引轻灵草1辅药枫香脂1丹炉寒铁铸心炉', '配方主药九叶芝1药引龙葵1辅药炼魂珠1丹炉寒铁铸心炉', '配方主药幻心草1药引弗兰草1辅药玄冰花1丹炉寒铁铸心炉', '配方主药鬼臼草1药引玄参1辅药炼血珠1丹炉寒铁铸心炉'],'化煞魔丸': ['配方主药血莲精1药引菩提花1辅药石龙芮1丹炉寒铁铸心炉', '配方主药鸡冠草1药引乌稠木1辅药锦地罗1丹炉寒铁铸心炉', '配方主药银精芝1药引雪凝花1辅药冰灵果1丹炉寒铁铸心炉', '配方主药玉髓芝1药引龙纹草1辅药玉龙参1丹炉寒铁铸心炉'],'素心真丸': ['配方主药地心火芝1药引天灵果1辅药伴妖草1丹炉寒铁铸心炉', '配方主药天蝉灵叶1药引灯心草1辅药剑心竹1丹炉寒铁铸心炉', '配方主药雪玉骨参1药引穿心莲1辅药绝魂草1丹炉寒铁铸心炉', '配方主药腐骨灵花1药引龙鳞果1辅药月灵花1丹炉寒铁铸心炉'],'灭神古丸': ['配方主药三叶青芝1药引白沉脂1辅药混元果1丹炉寒铁铸心炉', '配方主药七彩月兰1药引苦曼藤1辅药皇龙花1丹炉寒铁铸心炉', '配方主药冰灵焰草1药引诱妖草1辅药黑天麻1丹炉寒铁铸心炉'],'易筋丹': ['配方主药三尾风叶1药引血菩提1辅药天剑笋1丹炉寒铁铸心炉'],'静禅魔丸': ['配方主药地心淬灵乳1药引天问花1辅药血玉竹1丹炉寒铁铸心炉', '配方主药天麻翡石精1药引渊血冥花1辅药肠蚀草1丹炉寒铁铸心炉', '配方主药八角玄冰草1药引芒焰果1辅药凤血果1丹炉寒铁铸心炉', '配方主药奇茸通天菊1药引问道花1辅药冰精芝1丹炉寒铁铸心炉'],'地仙玄丸': ['配方主药檀芒九叶花1药引浩淼水藤1辅药太清玄灵草1丹炉寒铁铸心炉', '配方主药坎水玄冰果1药引道蕴花1辅药冥胎骨1丹炉寒铁铸心炉'],'消冰宝丸': ['配方主药剑魄竹笋1药引炼心芝1辅药鬼面花1丹炉寒铁铸心炉', '配方主药明心问道果1药引重元换血草1辅药梧桐木1丹炉寒铁铸心炉'],'化劫丹': [],'太上玄门丹': []};let currentPing = [...basePing];if (document.getElementById('use-high-herbs').checked) {currentPing = [...basePing, ...extraPing];}for (let nn in pe) {let danName = nn.slice(0, -1);if (document.getElementById('use-high-herbs').checked && (danName === '摄魂鬼丸' || danName === '化煞魔丸')) {continue;}let peItem = pe[nn];let mainHerbs = peItem[0];let assistHerbs = peItem[2];let herbList = peItem[1];if (herbList === basePing) {herbList = currentPing;}for (let i1 of mainHerbs) {for (let i2 of herbList) {for (let i3 of assistHerbs) {tempLi[danName].push(`配方主药${i1}药引${i2}辅药${i3}丹炉寒铁铸心炉`);}}}}return tempLi;}const danPriority = ['消冰宝丸', '太上玄门丹', '地仙玄丸', '化劫丹', '静禅魔丸', '灭神古丸', '易筋丹', '素心真丸', '化煞魔丸', '摄魂鬼丸'];function formatProfit(profit) {if (profit >= 10000) {return (profit / 10000).toFixed(2) + '亿灵石';} else {return profit + '万灵石';}}function calculateProfit(lisss) {let totalValue5 = 0;let totalValue6 = 0;let totalValue7 = 0;for (let n in lisss) {let pillValue = danValue[n];for (let i of lisss[n]) {let match = i.match(/丹炉寒铁铸心炉(\d+)$/);if (match) {let batches = parseInt(match[1]);totalValue5 += pillValue * batches * 5;totalValue6 += pillValue * batches * 6;totalValue7 += pillValue * batches * 7;}}}document.getElementById('profit-5').textContent = formatProfit(totalValue5);document.getElementById('profit-6').textContent = formatProfit(totalValue6);document.getElementById('profit-7').textContent = formatProfit(totalValue7);document.getElementById('profit-info').style.display = 'block';}function f1(lisss) {let result = '';for (let n in lisss) {for (let i of lisss[n]) {result += `<div class="item"><span>${n}&nbsp;&nbsp;\<br>${i.slice(0, 15)}\<br>${i.slice(15, )}</span><button class="copy-button copy-button1" data-text="${i}">复制</button></div>`;}}function showNotification(message) {let notification = document.getElementById('notification');if (!notification) {notification = document.createElement('div');notification.id = 'notification';document.body.appendChild(notification);}notification.textContent = message;notification.style.display = 'block';setTimeout(() => {notification.style.display = 'none';}, 2000);}function copyToClipboard(text) {showNotification(`复制成功`);const tempTextArea = document.createElement('textarea');tempTextArea.value = text;document.body.appendChild(tempTextArea);tempTextArea.select();document.execCommand('copy');document.body.removeChild(tempTextArea);}document.getElementById('herb-info').innerHTML = result;calculateProfit(lisss);document.querySelectorAll('.copy-button').forEach(button => {button.addEventListener('click', function () {const textToCopy = this.getAttribute('data-text');copyToClipboard(textToCopy);});});}function lis0(yybb) {let lisss = {};let tempHerbs = {...yybb};let currentLi = initLi();let currentPriority = [...danPriority];if (document.getElementById('use-high-herbs').checked) {currentPriority = currentPriority.filter(dan => dan !== '摄魂鬼丸' && dan !== '化煞魔丸');}for (let n of currentPriority) {if (!currentLi[n]) continue;for (let txt of currentLi[n]) {const txtPattern = /主药(.*?)(\d+)药引(.*?)(\d+)辅药(.*?)(\d+)丹炉寒铁铸心炉/g;let zy = txtPattern.exec(txt);if (!zy) continue;if (zy[1] !== zy[3] && zy[5] !== zy[3] && zy[1] !== zy[5]) {if (zy[1] in tempHerbs && tempHerbs[zy[1]] > 0 && zy[3] in tempHerbs && tempHerbs[zy[3]] > 0 && zy[5] in tempHerbs && tempHerbs[zy[5]] > 0) {let ss0 = [tempHerbs[zy[1]] / parseInt(zy[2]), tempHerbs[zy[3]] / parseInt(zy[4]), tempHerbs[zy[5]] / parseInt(zy[6])];let ss = Math.min(...ss0);if (ss > 0) {tempHerbs[zy[1]] -= ss * parseInt(zy[2]);tempHerbs[zy[3]] -= ss * parseInt(zy[4]);tempHerbs[zy[5]] -= ss * parseInt(zy[6]);try {lisss[n].push(`${txt}${ss}`);} catch (error) {lisss[n] = [`${txt}${ss}`];}}}}}}return lisss;}function extractInfo4(text) {
    let dicts = {};
    const namePattern = /([^\n]+?) (.*?)品药材 (.*?)数量:(.*)/g;
    const originalPattern1 = /名字：([^\n]+?)\n拥有数量:(\d+)/g;
    const originalPattern2 = /品级：.*?\n名字：([^\n]+?)\n拥有数量:(\d+)/g;
    const pagePattern = /名字：([^\n]+?)\n.*?\n拥有数量:(\d+)/g;
    
    let nameMatch;
    while ((nameMatch = namePattern.exec(text)) !== null) {
        const herbName = nameMatch[1].replaceAll('　', '').trim();
        dicts[herbName] = parseInt(nameMatch[4].replaceAll(' ', ''));
    }
    
    if (Object.keys(dicts).length === 0) {
        let originalMatch;
        while ((originalMatch = originalPattern1.exec(text)) !== null) {
            const herbName = originalMatch[1].trim();
            dicts[herbName] = parseInt(originalMatch[2]);
        }
        while ((originalMatch = originalPattern2.exec(text)) !== null) {
            const herbName = originalMatch[1].trim();
            dicts[herbName] = parseInt(originalMatch[2]);
        }
        while ((originalMatch = pagePattern.exec(text)) !== null) {
            const herbName = originalMatch[1].trim();
            dicts[herbName] = parseInt(originalMatch[2]);
        }
    }
    
    return dicts;
}document.getElementById('process-button').addEventListener('click', function () {const userInputText = document.getElementById('user-input').value;let dicts = extractInfo4(userInputText);if (dicts) {let lisss = lis0(dicts);f1(lisss);}});document.getElementById('clear-button').addEventListener('click', function () {document.getElementById('user-input').value = '';document.getElementById('herb-info').innerHTML = '';document.getElementById('profit-info').style.display = 'none';});</script></body></html>
<!--爱来自剑舜-->
